<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Work in Progress</title>
  <style>
    html,body {
      height:100%;
      margin:0;
      background:#000;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      overflow:hidden;
    }

    /* desktop / landscape background video */
    .bg-video {
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      z-index:0;
      pointer-events:none;
      filter:brightness(0.85);
      transition:transform 250ms ease;
    }

    /* mobile / portrait: rotate + oversize to crop 4:3 */
    .bg-video.portrait {
      top: 50%;
      left: 50%;
      width: 120vh;
      height: 120vw;
      transform: translate(-50%, -50%) rotate(90deg);
      object-fit: cover;
    }

    /* center text */
    .overlay {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:5;
      user-select:none;
      text-align:center;
      padding:1rem;
    }
    .center-stack {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:.5rem;
    }
    h1 {
      margin:0;
      color:#fff;
      font-size:clamp(2rem,6vw,4rem);
      letter-spacing:.04em;
      text-transform:uppercase;
      font-weight:700;
      text-shadow:0 6px 14px rgba(0,0,0,.6);
      transition:opacity .45s ease, transform .45s ease;
      pointer-events:none;
    }
    .hidden {
      opacity:0 !important;
      transform:translateY(6px) scale(.995);
      pointer-events:none;
    }

    /* secret popup */
    .secret {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:10;
      opacity:0;
      pointer-events:none;
      transition:opacity 420ms cubic-bezier(.22,.9,.35,1);
      will-change:opacity;
    }
    .secret.visible {
      opacity:1;
      pointer-events:auto;
    }
    .secret-inner {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:1rem;
      text-align:center;
      max-width:min(92vw, 900px);
      opacity:0;
      transform:translateZ(0) scale(.995);
      transition:opacity 420ms cubic-bezier(.22,.9,.35,1), transform 420ms cubic-bezier(.22,.9,.35,1);
    }
    .secret.visible .secret-inner {
      opacity:1;
      transform:translateZ(0) scale(1);
    }
    .secret video,
    .secret img {
      max-width:85vw;
      max-height:70vh;
      object-fit:contain;
      border-radius:6px;
      box-shadow:0 10px 30px rgba(0,0,0,.6);
      backface-visibility:hidden;
      -webkit-backface-visibility:hidden;
    }
    .secret p {
      margin:0;
      color:#fff;
      font-size:clamp(1rem,2.8vw,1.25rem);
      font-weight:600;
      text-shadow:0 4px 10px rgba(0,0,0,.6);
    }

    /* mobile sizing for popup */
    @media (max-width: 768px) {
      .secret video,
      .secret img {
        max-width: 96vw;
        max-height: 60vh;
      }
      h1 {
        font-size: clamp(1.8rem, 9vw, 3rem);
      }
    }

    @media (prefers-reduced-motion:reduce) {
      * { transition:none !important; animation:none !important; }
    }
  </style>
</head>
<body>

  <!-- background video -->
  <video id="bgVideo" class="bg-video" muted autoplay playsinline preload="auto" loop>
    <source src="background.mp4" type="video/mp4" />
  </video>

  <!-- centered text -->
  <div class="overlay">
    <div class="center-stack" id="centerStack" tabindex="0">
      <h1 id="mainHeading">Work in Progress</h1>
    </div>
  </div>

  <!-- secret popup -->
  <div class="secret" id="secretOverlay" aria-hidden="true">
    <div class="secret-inner">
      <video
        id="secretVideo"
        poster="kiwi.jpeg"
        playsinline
        webkit-playsinline
        preload="auto"
        controlsList="nodownload"
      >
        <source src="kiwi.mp4" type="video/mp4" />
      </video>
      <p>Kiwi says be patient!</p>
    </div>
  </div>

  <script>
  (function () {
    /* ====== CONFIG ====== */
    const WINDOW_MS     = 2000;  // 2s
    const NEEDED        = 10;    // 10 clicks
    const SECRET_HARD_MS= 5900;  // hard max popup time (covers your 6s video)
    const POST_SHOW_MS  = 600;   // after video ends, stay 0.6s

    /* ====== ELEMENTS ====== */
    const bgVideo       = document.getElementById('bgVideo');
    const mainHeading   = document.getElementById('mainHeading');
    const secretOverlay = document.getElementById('secretOverlay');
    const secretVideo   = document.getElementById('secretVideo');

    /* ====== ROTATE BG VIDEO ON PORTRAIT ====== */
    function applyVideoOrientation() {
      if (!bgVideo) return;
      const isPortrait = window.matchMedia("(orientation: portrait)").matches;
      if (isPortrait) {
        bgVideo.classList.add('portrait');
      } else {
        bgVideo.classList.remove('portrait');
      }
    }
    applyVideoOrientation();
    window.addEventListener('resize', applyVideoOrientation);
    window.addEventListener('orientationchange', applyVideoOrientation);

    // try to play background; if mobile blocks, we just leave it black
    if (bgVideo) {
      bgVideo.play().catch(() => {
        console.warn("Background video couldn't autoplay on this device.");
      });
    }

    /* ====== SECRET LOGIC ====== */
    let clicks = [];
    let secretTimeout = null;
    let secretActive = false;

    function clearSecretTimeout() {
      if (secretTimeout) {
        clearTimeout(secretTimeout);
        secretTimeout = null;
      }
    }

    function showSecret() {
      if (secretActive) return;
      secretActive = true;
      clearSecretTimeout();

      // hide WIP text
      mainHeading.classList.add('hidden');

      // show overlay
      secretOverlay.classList.add('visible');
      secretOverlay.setAttribute('aria-hidden','false');

      // hard timeout: even if video doesn't play, close after SECRET_HARD_MS
      secretTimeout = setTimeout(hideSecret, SECRET_HARD_MS);

      // now try to play video with sound
      if (secretVideo) {
        try { secretVideo.pause(); secretVideo.currentTime = 0; } catch(e){}
        secretVideo.muted = false; // we had user interaction (10 clicks), so this should be allowed
        const playPromise = secretVideo.play();
        if (playPromise !== undefined) {
          playPromise.then(() => {
            // video is actually playing; when it ends, we close sooner
            secretVideo.onended = () => {
              clearSecretTimeout();
              secretTimeout = setTimeout(hideSecret, POST_SHOW_MS);
            };
          }).catch(err => {
            console.warn("Secret video couldn't play, showing poster only:", err);
            // we already set a hard timeout above, so nothing else to do
          });
        }
      }
    }

    function hideSecret() {
      if (!secretActive) return;
      secretActive = false;
      clearSecretTimeout();

      // hide popup
      secretOverlay.classList.remove('visible');
      secretOverlay.setAttribute('aria-hidden','true');

      // stop video
      if (secretVideo) {
        try { secretVideo.pause(); } catch(e){}
        try { secretVideo.currentTime = 0; } catch(e){}
        secretVideo.onended = null;
      }

      // bring back WIP text
      setTimeout(() => {
        mainHeading.classList.remove('hidden');
      }, 120);
    }

    /* ====== CLICK DETECTION (whole screen) ====== */
    function registerClick(e) {
      // ignore clicks on real interactive elements
      const tag = e.target && e.target.tagName ? e.target.tagName.toLowerCase() : '';
      if (['video','a','button','input','textarea','select','label'].includes(tag)) {
        return;
      }

      const now = Date.now();
      clicks.push(now);
      clicks = clicks.filter(ts => now - ts <= WINDOW_MS);
      if (clicks.length >= NEEDED) {
        clicks = [];
        showSecret();
      }
    }

    document.addEventListener('click', registerClick);
    document.addEventListener('keyup', (e) => {
      if (e.key === 'Enter' || e.key === ' ') registerClick(e);
    });

    // if user backgrounds the tab while secret is open, close it
    window.addEventListener('blur', () => {
      if (secretActive) hideSecret();
    });

  })();
  </script>
</body>
</html>
