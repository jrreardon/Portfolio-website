<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Work in Progress</title>
  <style>
    html,body {
      height:100%;
      margin:0;
      background:#000;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      overflow:hidden;
    }

    /* background video for desktop */
    .bg-video {
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
      object-fit:cover;
      z-index:0;
      pointer-events:none;
      filter:brightness(0.5);
    }

    /* center text */
    .overlay {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:5;
      user-select:none;
      text-align:center;
      padding:1rem;
    }
    .center-stack {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:.5rem;
    }
    h1 {
      margin:0;
      color:#fff;
      font-size:clamp(2rem,6vw,4rem);
      letter-spacing:.04em;
      text-transform:uppercase;
      font-weight:700;
      text-shadow:0 6px 14px rgba(0,0,0,.6);
      transition:opacity .45s ease, transform .45s ease;
      will-change:opacity,transform;
      pointer-events:none;
    }
    .hidden {
      opacity:0 !important;
      transform:translateY(6px) scale(.995);
      pointer-events:none;
    }

    /* secret overlay with smoother animation */
    .secret {
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      z-index:10;
      opacity:0;
      pointer-events:none;
      transition:opacity 420ms cubic-bezier(.22,.9,.35,1);
      will-change:opacity;
    }
    .secret.visible {
      opacity:1;
      pointer-events:auto;
    }
    .secret-inner {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:1rem;
      text-align:center;
      max-width:min(92vw, 900px);
      opacity:0;
      transform:translateZ(0) scale(.995);
      transition:opacity 420ms cubic-bezier(.22,.9,.35,1), transform 420ms cubic-bezier(.22,.9,.35,1);
      will-change:opacity,transform;
    }
    .secret.visible .secret-inner {
      opacity:1;
      transform:translateZ(0) scale(1);
    }
    .secret video,
    .secret img {
      max-width:85vw;
      max-height:70vh;
      object-fit:contain;
      border-radius:6px;
      box-shadow:0 10px 30px rgba(0,0,0,.6);
      backface-visibility:hidden;
      -webkit-backface-visibility:hidden;
      -webkit-transform:translateZ(0);
    }
    .secret p {
      margin:0;
      color:#fff;
      font-size:clamp(1rem,2.8vw,1.25rem);
      font-weight:600;
      text-shadow:0 4px 10px rgba(0,0,0,.6);
    }

    /* -------- mobile / portrait tweaks -------- */
    @media (max-width: 768px), (orientation: portrait) {
      /* just make background black on mobile */
      .bg-video {
        display: none;
      }
      body {
        background: #000;
      }
      h1 {
        font-size: clamp(1.8rem, 9vw, 3rem);
      }
      .secret video,
      .secret img {
        max-width: 96vw;
        max-height: 60vh;
      }
    }

    @media (prefers-reduced-motion:reduce) {
      * { transition:none !important; animation:none !important; }
    }
  </style>
</head>
<body>

  <!-- desktop background video -->
  <video id="bgVideo" class="bg-video" muted autoplay playsinline preload="auto" loop>
    <source src="background.mp4" type="video/mp4" />
  </video>

  <!-- center text -->
  <div class="overlay">
    <div class="center-stack" id="centerStack" tabindex="0" aria-label="Secret trigger">
      <h1 id="mainHeading">Work in Progress</h1>
    </div>
  </div>

  <!-- secret popup -->
  <div class="secret" id="secretOverlay" aria-hidden="true">
    <div class="secret-inner">
      <!-- secret video: 6s long, with poster -->
      <video
        id="secretVideo"
        poster="kiwi.jpeg"
        playsinline
        webkit-playsinline
        preload="auto"
        controlsList="nodownload"
      >
        <source src="kiwi.mp4" type="video/mp4" />
      </video>
      <p>Kiwi says be patient!</p>
    </div>
  </div>

  <script>
  (function () {
    /* config */
    const WINDOW_MS = 2000;   // 10 clicks in 2s
    const NEEDED    = 10;
    const POST_SHOW_MS = 600; // after video ends, keep popup 0.6s
    const MAX_FALLBACK_MS = 3500; // if no secret video plays, show poster this long

    const isMobile = window.matchMedia("(max-width: 768px), (orientation: portrait)").matches;

    /* elements */
    const bg           = document.getElementById('bgVideo');
    const mainHeading  = document.getElementById('mainHeading');
    const secretOverlay= document.getElementById('secretOverlay');
    const secretVideo  = document.getElementById('secretVideo');

    /* background video: desktop only */
    function initBackground() {
      if (!bg) return;
      if (isMobile) {
        // hide it for mobile so kiwi.jpeg doesn't take over
        bg.style.display = 'none';
        return;
      }
      bg.play().catch(() => {
        // if desktop still can’t autoplay, just hide it and keep black bg
        bg.style.display = 'none';
      });
    }

    initBackground();

    /* secret logic */
    let clicks = [];
    let secretTimeout = null;
    let secretActive  = false;

    function clearSecretTimeout() {
      if (secretTimeout) {
        clearTimeout(secretTimeout);
        secretTimeout = null;
      }
    }

    function showSecret() {
      if (secretActive) return;
      secretActive = true;
      clearSecretTimeout();

      // hide heading
      mainHeading.classList.add('hidden');

      // show overlay
      secretOverlay.classList.add('visible');
      secretOverlay.setAttribute('aria-hidden', 'false');

      // play video if we have it
      if (secretVideo) {
        // reset
        try { secretVideo.pause(); secretVideo.currentTime = 0; } catch(e){}
        secretVideo.muted = false; // allow sound – we had a user gesture
        secretVideo.play().then(() => {
          // when video ends, hide after a short delay
          secretVideo.onended = () => {
            clearSecretTimeout();
            secretTimeout = setTimeout(hideSecret, POST_SHOW_MS);
          };
        }).catch(err => {
          console.warn("secret video couldn't play (mobile autoplay, missing file, etc):", err);
          // fallback: show poster for MAX_FALLBACK_MS
          clearSecretTimeout();
          secretTimeout = setTimeout(hideSecret, MAX_FALLBACK_MS);
        });
      } else {
        // no video element at all
        clearSecretTimeout();
        secretTimeout = setTimeout(hideSecret, MAX_FALLBACK_MS);
      }
    }

    function hideSecret() {
      if (!secretActive) return;
      secretActive = false;
      clearSecretTimeout();

      // hide overlay
      secretOverlay.classList.remove('visible');
      secretOverlay.setAttribute('aria-hidden', 'true');

      // stop video
      if (secretVideo) {
        try { secretVideo.pause(); } catch(e){}
        try { secretVideo.currentTime = 0; } catch(e){}
        secretVideo.onended = null;
      }

      // bring heading back
      setTimeout(() => {
        mainHeading.classList.remove('hidden');
      }, 120);
    }

    /* click detection — whole screen */
    function registerClick(e) {
      // let normal controls work without counting
      const tag = e.target && e.target.tagName ? e.target.tagName.toLowerCase() : '';
      if (['video','a','button','input','textarea','select','label'].includes(tag)) {
        return;
      }

      const now = Date.now();
      clicks.push(now);
      clicks = clicks.filter(ts => now - ts <= WINDOW_MS);
      if (clicks.length >= NEEDED) {
        clicks = [];
        showSecret();
      }
    }

    document.addEventListener('click', registerClick);
    document.addEventListener('keyup', (e) => {
      if (e.key === 'Enter' || e.key === ' ') registerClick(e);
    });

    // if you switch tabs while secret is open, hide it so it doesn't get stuck
    window.addEventListener('blur', () => {
      if (secretActive) hideSecret();
    });
  })();
  </script>
</body>
</html>
